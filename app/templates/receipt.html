<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        @page {
            size: A4;
            margin: 10mm;
        }
        body {
            font-family: sans-serif;
            font-size: 10pt;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .header h1 { margin: 0; font-size: 16pt; text-transform: uppercase; }
        .header p { margin: 2px 0; font-size: 9pt; color: #555; }

        .info-grid {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .info-box {
            width: 48%;
            border: 1px solid #ccc;
            padding: 10px;
            background: #f9f9f9;
        }
        .info-box h3 { margin-top: 0; font-size: 11pt; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .row { display: flex; justify-content: space-between; margin-bottom: 4px; }
        .label { font-weight: bold; color: #555; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #333;
            padding: 6px;
            text-align: right;
        }
        th {
            background: #eee;
            text-align: center;
            font-weight: bold;
        }
        .col-left { text-align: left; }

        .total-block {
            text-align: right;
            font-size: 14pt;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .qr-section {
            display: flex;
            justify-content: space-around;
            border-top: 2px dashed #999;
            padding-top: 20px;
        }
        .qr-box {
            text-align: center;
            width: 45%;
        }
        .qr-box img {
            width: 120px;
            height: 120px;
        }
        .qr-desc {
            font-size: 8pt;
            margin-top: 5px;
            color: #777;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>ПЛАТЕЖНЫЙ ДОКУМЕНТ</h1>
        <p>за расчетный период: <strong>{{ period_name }}</strong></p>
    </div>

    <div class="info-grid">
        <div class="info-box">
            <h3>Плательщик</h3>
            <div class="row"><span class="label">ФИО:</span> <span>{{ user.username }}</span></div>
            <div class="row"><span class="label">Л/С:</span> <span>{{ user.id }}</span></div>
            <div class="row"><span class="label">Адрес:</span> <span>{{ user.dormitory }}</span></div>
            <div class="row"><span class="label">Площадь:</span> <span>{{ user.apartment_area }} м²</span></div>
            <div class="row"><span class="label">Жильцов:</span> <span>{{ user.residents_count }}</span></div>
        </div>
        <div class="info-box">
            <h3>Получатель</h3>
            <div class="row"><span class="label">Организация:</span> <span>ФГКУ "ЦСООР "Лидер"</span></div>
            <div class="row"><span class="label">ИНН:</span> <span>5003008102</span></div>
            <div class="row"><span class="label">Р/С:</span> <span>03100643000000017300</span></div>
        </div>
    </div>

    <!-- ТАБЛИЦА РАСЧЕТОВ -->
    <table>
        <thead>
            <tr>
                <th>Наименование услуги</th>
                <th>Ед.изм.</th>
                <th>Объем</th>
                <th>Тариф (руб)</th>
                <th>Сумма (руб)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="col-left">Содержание и ремонт</td>
                <td>м²</td>
                <td>{{ user.apartment_area }}</td>
                <td>{{ tariff.maintenance_repair }}</td>
                <td>{{ reading.cost_maintenance|round(2) }}</td>
            </tr>
            <tr>
                <td class="col-left">Наем жилого помещения</td>
                <td>м²</td>
                <td>{{ user.apartment_area }}</td>
                <td>{{ tariff.social_rent }}</td>
                <td>{{ reading.cost_social_rent|round(2) }}</td>
            </tr>
            <tr>
                <td class="col-left">Отопление</td>
                <td>м²</td>
                <td>{{ user.apartment_area }}</td>
                <td>{{ tariff.heating }}</td>
                <!-- Внимание: в модели cost_fixed_part - это сумма отопления и ОДН.
                     Для упрощения выводим как есть, или нужно делить -->
                <td>{{ (user.apartment_area * tariff.heating)|round(2) }}</td>
            </tr>
            <tr>
                <td class="col-left">Вывоз мусора (ТКО)</td>
                <td>м²</td>
                <td>{{ user.apartment_area }}</td>
                <td>{{ tariff.waste_disposal }}</td>
                <td>{{ reading.cost_waste|round(2) }}</td>
            </tr>

            <!-- КОММУНАЛЬНЫЕ -->
            <tr><td colspan="5" style="background:#f9f9f9; text-align:left; font-weight:bold;">По счетчикам</td></tr>

            <tr>
                <td class="col-left">Холодное водоснабжение</td>
                <td>м³</td>
                <td>{{ vol_cold|round(2) }}</td>
                <td>{{ tariff.water_supply }}</td>
                <td>{{ reading.cost_cold_water|round(2) }}</td>
            </tr>
            <tr>
                <td class="col-left">Горячее водоснабжение</td>
                <td>м³</td>
                <td>{{ vol_hot|round(2) }}</td>
                <td>{{ (tariff.water_supply + tariff.water_heating)|round(2) }}</td>
                <td>{{ reading.cost_hot_water|round(2) }}</td>
            </tr>
            <tr>
                <td class="col-left">Водоотведение</td>
                <td>м³</td>
                <td>{{ vol_sewage|round(2) }}</td>
                <td>{{ tariff.sewage }}</td>
                <td>{{ reading.cost_sewage|round(2) }}</td>
            </tr>
            <tr>
                <td class="col-left">Электроэнергия (Инд. + ОДН)</td>
                <td>кВт*ч</td>
                <td>{{ vol_elect|round(2) }}</td>
                <td>{{ tariff.electricity_rate }}</td>
                <td>{{ (reading.cost_electricity + (user.apartment_area * tariff.electricity_per_sqm))|round(2) }}</td>
            </tr>
        </tbody>
    </table>

    <div class="total-block">
        ИТОГО К ОПЛАТЕ: {{ reading.total_cost|round(2) }} руб.
    </div>

    <div class="qr-section">
        <div class="qr-box">
            <img src="data:image/png;base64,{{ qr_rent_b64 }}" alt="QR Rent">
            <p class="qr-desc">Плата за наем (QR)<br>Сумма: {{ reading.cost_social_rent|round(2) }}</p>
        </div>
        <div class="qr-box">
            <img src="data:image/png;base64,{{ qr_utils_b64 }}" alt="QR Utils">
            <p class="qr-desc">Коммунальные услуги (QR)<br>Сумма: {{ (reading.total_cost - reading.cost_social_rent)|round(2) }}</p>
        </div>
    </div>

</body>
</html>