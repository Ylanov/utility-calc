<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ñ–ö–•</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –∏ —Å–ø–∏–Ω–Ω–µ—Ä–æ–≤ */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal-overlay.open { display: flex; }
        .modal-window { background: white; padding: 25px; border-radius: 10px; width: 500px; max-width: 90%; box-shadow: 0 4px 15px rgba(0,0,0,0.2); position: relative; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { font-size: 20px; font-weight: bold; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; color: #333; }
        .modal-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-row label { width: 60%; color: #555; font-size: 14px; }
        .modal-row input { width: 35%; padding: 8px; text-align: center; border: 1px solid #ccc; border-radius: 5px; }
        .modal-actions { margin-top: 25px; display: flex; justify-content: flex-end; gap: 10px; }
        .close-btn { background: #95a5a6; color: white; }
        .confirm-btn { background: #27ae60; color: white; }
        .highlight-calc { background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; font-size: 14px; border-left: 4px solid #4a90e2; line-height: 1.6; }
        .role-badge { padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; color: white; }
        .role-badge.user { background-color: #3498db; }
        .role-badge.accountant { background-color: #f39c12; }
        .pagination { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .pagination button { padding: 5px 12px; font-size: 14px; background: #e0e0e0; border: none; border-radius: 4px; cursor: pointer; }
        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
        .action-btn-small { background: none; border: none; cursor: pointer; font-size: 18px; padding: 5px; border-radius: 50%; width: 32px; height: 32px; transition: background-color 0.2s; }
        .action-btn-small:hover { background-color: #f0f0f0; }
    </style>
</head>
<body>

    <div class="container">
        <!-- HEADER -->
        <header>
            <h1>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ñ–ö–•</h1>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span id="adminName" style="font-weight: bold; color: #555;"></span>
                <button class="logout-btn">–í—ã–π—Ç–∏</button> <!-- –£–¥–∞–ª–µ–Ω onclick -->
            </div>
        </header>

        <!-- NAV TABS (–°–∏—Å—Ç–µ–º–∞ —É–¥–∞–ª–µ–Ω–∞) -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="readings">üîç –°–≤–µ—Ä–∫–∞</button>
            <button class="tab-btn" data-tab="users">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button class="tab-btn" data-tab="tariffs">‚öôÔ∏è –¢–∞—Ä–∏—Ñ—ã</button>
            <button class="tab-btn" data-tab="accountant">üìä –°–≤–æ–¥–∫–∞</button>
        </div>

        <!-- TAB 1: –°–í–ï–†–ö–ê –ü–û–ö–ê–ó–ê–ù–ò–ô -->
        <div id="readings" class="tab-content active">
            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–º -->
            <div class="card" style="background: linear-gradient(to right, #eef2f3, #8e9eab); border:none; margin-bottom: 20px;">
                <div id="periodActiveState" style="display:none; justify-content:space-between; align-items:center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h2 style="margin:0; border:none; color:#333; font-size: 18px;">
                            üü¢ –û—Ç–∫—Ä—ã—Ç —Å–±–æ—Ä –ø–æ–∫–∞–∑–∞–Ω–∏–π: <span id="activePeriodLabel" style="color:#2980b9; font-weight:bold;"></span>
                        </h2>
                        <small style="color:#555;">–ñ–∏–ª—å—Ü—ã –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–∫—Ä—ã—Ç—å", —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å –º–µ—Å—è—Ü.</small>
                    </div>
                    <button class="action-btn" style="margin:0; background:#c0392b; width:auto; padding: 8px 15px;">üîí –ó–∞–∫—Ä—ã—Ç—å –º–µ—Å—è—Ü</button>
                </div>

                <div id="periodClosedState" style="display:none; justify-content:space-between; align-items:center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h2 style="margin:0; border:none; color:#555; font-size: 18px;">üî¥ –ü—Ä–∏–µ–º –ø–æ–∫–∞–∑–∞–Ω–∏–π –∑–∞–∫—Ä—ã—Ç</h2>
                        <small style="color:#555;">–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Å—è—Ü, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–û—Ç–∫—Ä—ã—Ç—å".</small>
                    </div>
                    <div style="display:flex; gap:10px; align-items: center;">
                        <input type="text" id="newPeriodNameInput" placeholder="–ù–∞–ø—Ä. –ê–ø—Ä–µ–ª—å 2026" style="padding:8px; border-radius:4px; border:1px solid #ccc; width: 220px;">
                        <button class="action-btn" style="margin:0; background:#27ae60; width:auto; padding: 8px 15px;">üìÇ –û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π –º–µ—Å—è—Ü</button>
                    </div>
                </div>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2>–ü–æ—Å—Ç—É–ø–∏–≤—à–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è (–ß–µ—Ä–Ω–æ–≤–∏–∫–∏)</h2>
                    <div style="display: flex; gap: 10px;">
                        <button id="btnBulkApprove" class="action-btn" style="background:#f39c12; margin:0; width: auto; font-size: 13px; padding: 8px 15px;">‚ö° –£—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—Å–µ (–ê–≤—Ç–æ)</button>
                        <button id="btnRefreshReadings" class="refresh-btn" style="margin:0; height: 38px;">‚Üª –û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                </div>

                <div style="margin-bottom: 15px; padding: 10px; background: #fdf8e2; border-radius: 5px; border: 1px solid #f1c40f;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: bold;">
                        <input type="checkbox" id="filterAnomalies"> –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
                    </label>
                </div>

                <div class="pagination">
                    <button id="btnPrev">‚Üê –ù–∞–∑–∞–¥</button>
                    <span id="pageIndicator" style="font-weight: bold; min-width: 80px; text-align: center;">–°—Ç—Ä. 1</span>
                    <button id="btnNext">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
                </div>

                <div class="table-container">
                    <table id="readingsTable">
                        <thead>
                            <tr>
                                <th>–ñ–∏–ª–µ—Ü</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ì.–í–æ–¥–∞</th><th>–•.–í–æ–¥–∞</th><th>–°–≤–µ—Ç</th><th>–°—É–º–º–∞</th><th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                            </tr>
                        </thead>
                        <tbody id="readingsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB 2: –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò -->
        <div id="users" class="tab-content">
            <div class="card" style="border-left: 5px solid #2ecc71;">
                <h2>üìÅ –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∂–∏–ª—å—Ü–æ–≤ (Excel)</h2>
                <div style="display:flex; gap:10px; align-items:center;">
                    <input type="file" id="importUsersFile" accept=".xlsx" style="padding:5px;">
                    <button class="action-btn" style="width:auto; margin:0;" onclick="importUsers()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>

            <div class="card">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∂–∏–ª—å—Ü–∞</h2>
                <form id="addUserForm">
                    <div class="form-grid">
                        <div class="form-group"><label>–õ–æ–≥–∏–Ω</label><input type="text" id="newUsername" required></div>
                        <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="password" id="newPassword" required></div>
                        <div class="form-group"><label>–†–æ–ª—å</label><select id="newRole"><option value="user">–ñ–∏–ª–µ—Ü</option><option value="accountant">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä</option></select></div>
                        <div class="form-group"><label>–û–±—â–µ–∂–∏—Ç–∏–µ</label><input type="text" id="dormitory"></div>
                        <div class="form-group"><label>–ü–ª–æ—â–∞–¥—å (–º¬≤)</label><input type="number" step="0.1" id="area" value="0"></div>
                        <div class="form-group"><label>–ü–ª–∞—Ç–∏—Ç –∑–∞ (—á–µ–ª)</label><input type="number" id="residentsCount" value="1"></div>
                        <div class="form-group"><label>–í—Å–µ–≥–æ –≤ –∫–æ–º–Ω–∞—Ç–µ</label><input type="number" id="totalRoomResidents" value="1"></div>
                        <div class="form-group full-width"><label>–ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã</label><input type="text" id="workplace"></div>
                    </div>
                    <button type="submit" class="action-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                </form>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h2>–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
                    <button id="btnRefreshUsers" class="refresh-btn">‚Üª –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
                </div>
                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                            <tr><th>ID</th><th>–õ–æ–≥–∏–Ω</th><th>–†–æ–ª—å</th><th>–û–±—â.</th><th>–ü–ª–æ—â.</th><th>–î–æ–ª—è</th><th>–†–∞–±–æ—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr>
                        </thead>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB 3: –¢–ê–†–ò–§–´ -->
        <div id="tariffs" class="tab-content">
            <div class="card">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ (—Ä—É–±.)</h2>
                <form id="tariffsForm">
                    <div class="tariffs-grid">
                        <div class="tariff-item"><label>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∏ —Ä–µ–º–æ–Ω—Ç</label><input type="number" step="0.01" id="t_main" required></div>
                        <div class="tariff-item"><label>–ù–∞–µ–º –∂–∏–ª—å—è</label><input type="number" step="0.01" id="t_rent" required></div>
                        <div class="tariff-item"><label>–¢–ö–û (–ú—É—Å–æ—Ä)</label><input type="number" step="0.01" id="t_waste" required></div>
                        <div class="tariff-item"><label>–û—Ç–æ–ø–ª–µ–Ω–∏–µ</label><input type="number" step="0.01" id="t_heat" required></div>
                        <div class="tariff-item"><label>–ü–æ–¥–æ–≥—Ä–µ–≤ –ì–í–°</label><input type="number" step="0.01" id="t_w_heat" required></div>
                        <div class="tariff-item"><label>–ü–æ–¥–∞—á–∞ –≤–æ–¥—ã</label><input type="number" step="0.01" id="t_w_sup" required></div>
                        <div class="tariff-item"><label>–í–æ–¥–æ–æ—Ç–≤–µ–¥–µ–Ω–∏–µ</label><input type="number" step="0.01" id="t_sew" required></div>
                        <div class="tariff-item"><label>–≠–ª. –≠–Ω–µ—Ä–≥–∏—è (—Ç–∞—Ä–∏—Ñ)</label><input type="number" step="0.01" id="t_el_rate" required></div>
                        <div class="tariff-item"><label>–≠–ª. —ç–Ω–µ—Ä–≥–∏—è (–û–î–ù)</label><input type="number" step="0.01" id="t_el_sqm" required></div>
                    </div>
                    <button type="submit" class="action-btn" style="background-color: #27ae60; margin-top: 30px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã</button>
                </form>
            </div>
        </div>

        <!-- TAB 5: –°–í–û–î–ö–ê -->
        <div id="accountant" class="tab-content">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞</h2>
                    <div style="display: flex; gap: 10px;">
                        <button id="btnDownloadExcel" class="action-btn" style="margin:0; background:#27ae60;">üìä –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç (.xlsx)</button>
                        <button id="btnRefreshSummary" class="refresh-btn">‚Üª –û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>
                </div>
                <div class="table-container" id="summaryContainer"></div>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ò -->
    <div id="approveModal" class="modal-overlay">
        <div class="modal-window">
            <div class="modal-header">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ö–æ—Ä—Ä–µ–∫—Ü–∏—è</div>
            <input type="hidden" id="modal_reading_id">
            <div class="highlight-calc">
                <strong>–ñ–∏–ª–µ—Ü:</strong> <span id="m_username"></span><br>
                –ì–í–° (–Ω–∞–±–µ–∂–∞–ª–æ): <span id="m_hot_usage"></span> –º¬≥<br>
                –•–í–° (–Ω–∞–±–µ–∂–∞–ª–æ): <span id="m_cold_usage"></span> –º¬≥<br>
                –°–≤–µ—Ç (–æ–±—â–∏–π): <span id="m_elect_usage"></span> –∫–í—Ç
            </div>
            <div class="modal-row"><label>–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –ì.–í.:</label><input type="number" step="0.01" id="m_corr_hot" value="0"></div>
            <div class="modal-row"><label>–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –•.–í.:</label><input type="number" step="0.01" id="m_corr_cold" value="0"></div>
            <div class="modal-row"><label>–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –°–≤–µ—Ç–∞:</label><input type="number" step="0.01" id="m_corr_elect" value="0"></div>
            <div class="modal-row"><label>–ö–æ—Ä—Ä. –í–æ–¥–æ–æ—Ç–≤–µ–¥–µ–Ω–∏—è:</label><input type="number" step="0.01" id="m_corr_sewage" value="0"></div>
            <div class="modal-actions">
                <button id="btnModalClose" class="action-btn close-btn">–û—Ç–º–µ–Ω–∞</button>
                <button id="btnModalSubmit" class="action-btn confirm-btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="userEditModal" class="modal-overlay">
        <div class="modal-window">
            <div class="modal-header">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="form-grid">
                    <div class="form-group"><label>–õ–æ–≥–∏–Ω</label><input type="text" id="editUsername" required></div>
                    <div class="form-group"><label>–ü–∞—Ä–æ–ª—å</label><input type="text" id="editPassword" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º..."></div>
                    <div class="form-group"><label>–†–æ–ª—å</label><select id="editRole"><option value="user">–ñ–∏–ª–µ—Ü</option><option value="accountant">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä</option></select></div>
                    <div class="form-group"><label>–û–±—â–µ–∂–∏—Ç–∏–µ</label><input type="text" id="editDormitory"></div>
                    <div class="form-group"><label>–ü–ª–æ—â–∞–¥—å (–º¬≤)</label><input type="number" step="0.1" id="editArea"></div>
                    <div class="form-group"><label>–ü–ª–∞—Ç–∏—Ç –∑–∞</label><input type="number" id="editResidentsCount"></div>
                    <div class="form-group"><label>–í—Å–µ–≥–æ –≤ –∫–æ–º–Ω–∞—Ç–µ</label><input type="number" id="editTotalRoomResidents"></div>
                    <div class="form-group"><label>–ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã</label><input type="text" id="editWorkplace"></div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="action-btn close-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="action-btn confirm-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ï–î–ò–ù–û–ì–û –ú–û–î–£–õ–Ø -->
    <script type="module" src="js/app.js"></script>
</body>
</html>